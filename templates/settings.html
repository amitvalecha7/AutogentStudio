{% extends "base.html" %}

{% block title %}Settings - Autogent Studio{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Settings Sidebar -->
        <div class="col-md-3 bg-secondary border-end">
            <div class="p-3 border-bottom">
                <h5 class="mb-0">
                    <i class="fas fa-cog me-2"></i>Settings
                </h5>
            </div>
            
            <div class="list-group list-group-flush">
                <a href="{{ url_for('settings.settings_index') }}" class="list-group-item list-group-item-action bg-secondary text-light active">
                    <i class="fas fa-home me-2"></i>General
                </a>
                <a href="{{ url_for('settings.model_settings') }}" class="list-group-item list-group-item-action bg-secondary text-light">
                    <i class="fas fa-brain me-2"></i>Model Providers
                </a>
                <a href="{{ url_for('settings.image_settings') }}" class="list-group-item list-group-item-action bg-secondary text-light">
                    <i class="fas fa-image me-2"></i>Image Generation
                </a>
                <a href="{{ url_for('settings.rag_settings') }}" class="list-group-item list-group-item-action bg-secondary text-light">
                    <i class="fas fa-database me-2"></i>RAG Configuration
                </a>
                <a href="{{ url_for('settings.quantum_settings') }}" class="list-group-item list-group-item-action bg-secondary text-light">
                    <i class="fas fa-atom me-2"></i>Quantum Computing
                </a>
                <a href="{{ url_for('settings.federated_settings') }}" class="list-group-item list-group-item-action bg-secondary text-light">
                    <i class="fas fa-network-wired me-2"></i>Federated Learning
                </a>
                <a href="{{ url_for('settings.neuromorphic_settings') }}" class="list-group-item list-group-item-action bg-secondary text-light">
                    <i class="fas fa-microchip me-2"></i>Neuromorphic Computing
                </a>
                <a href="{{ url_for('settings.safety_settings') }}" class="list-group-item list-group-item-action bg-secondary text-light">
                    <i class="fas fa-shield-alt me-2"></i>AI Safety
                </a>
                <a href="{{ url_for('settings.self_improving_settings') }}" class="list-group-item list-group-item-action bg-secondary text-light">
                    <i class="fas fa-cog me-2"></i>Self-Improving AI
                </a>
                <a href="{{ url_for('settings.blockchain_settings') }}" class="list-group-item list-group-item-action bg-secondary text-light">
                    <i class="fas fa-link me-2"></i>Blockchain
                </a>
                <a href="{{ url_for('settings.orchestration_settings') }}" class="list-group-item list-group-item-action bg-secondary text-light">
                    <i class="fas fa-project-diagram me-2"></i>Orchestration
                </a>
                <a href="{{ url_for('settings.security_settings') }}" class="list-group-item list-group-item-action bg-secondary text-light">
                    <i class="fas fa-lock me-2"></i>Security
                </a>
                <a href="{{ url_for('settings.preferences') }}" class="list-group-item list-group-item-action bg-secondary text-light">
                    <i class="fas fa-user-cog me-2"></i>Preferences
                </a>
                <a href="{{ url_for('settings.about') }}" class="list-group-item list-group-item-action bg-secondary text-light">
                    <i class="fas fa-info-circle me-2"></i>About
                </a>
            </div>
        </div>
        
        <!-- Main Settings Content -->
        <div class="col-md-9">
            <div class="p-4">
                <h2 class="mb-4">
                    <i class="fas fa-cog me-2"></i>General Settings
                </h2>
                
                <!-- API Keys Overview -->
                <div class="card bg-dark border-primary mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-key me-2"></i>API Keys
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            {% for api_key in api_keys %}
                                <div class="col-md-6 mb-3">
                                    <div class="card bg-secondary">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div>
                                                    <h6 class="card-title mb-1">{{ api_key.provider|title }}</h6>
                                                    <p class="card-text text-muted small mb-0">
                                                        Status: 
                                                        {% if api_key.is_active %}
                                                            <span class="badge bg-success">Active</span>
                                                        {% else %}
                                                            <span class="badge bg-danger">Inactive</span>
                                                        {% endif %}
                                                    </p>
                                                </div>
                                                <div class="btn-group">
                                                    <button class="btn btn-sm btn-outline-light" onclick="toggleApiKey('{{ api_key.id }}')">
                                                        <i class="fas fa-power-off"></i>
                                                    </button>
                                                    <button class="btn btn-sm btn-outline-danger" onclick="deleteApiKey('{{ api_key.id }}')">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                        <div class="text-center mt-3">
                            <button class="btn btn-primary" onclick="addApiKey()">
                                <i class="fas fa-plus me-2"></i>Add API Key
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Settings -->
                <div class="card bg-dark border-secondary mb-4">
                    <div class="card-header bg-secondary text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-tachometer-alt me-2"></i>Quick Settings
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Default AI Model</label>
                                    <select class="form-select bg-dark text-light border-secondary">
                                        <option value="gpt-4o">GPT-4o</option>
                                        <option value="claude-sonnet-4">Claude Sonnet 4</option>
                                        <option value="gemini-pro">Gemini Pro</option>
                                        <option value="quantum-enhanced">Quantum Enhanced</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Default Temperature</label>
                                    <input type="range" class="form-range" min="0" max="2" step="0.1" value="0.7">
                                    <div class="d-flex justify-content-between">
                                        <small class="text-muted">0.0</small>
                                        <small class="text-muted">2.0</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="quantumEnhanced" checked>
                                    <label class="form-check-label" for="quantumEnhanced">
                                        Enable Quantum Enhancement
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="neuromorphicProcessing" checked>
                                    <label class="form-check-label" for="neuromorphicProcessing">
                                        Neuromorphic Processing
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="aiSafety" checked>
                                    <label class="form-check-label" for="aiSafety">
                                        AI Safety Protocols
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="selfImprovement" checked>
                                    <label class="form-check-label" for="selfImprovement">
                                        Self-Improving AI
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- System Status -->
                <div class="card bg-dark border-info mb-4">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-heartbeat me-2"></i>System Status
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="text-center">
                                    <div class="mb-2">
                                        <span class="badge bg-success fs-6">Online</span>
                                    </div>
                                    <small class="text-muted">API Status</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center">
                                    <div class="mb-2">
                                        <span class="badge bg-success fs-6">Active</span>
                                    </div>
                                    <small class="text-muted">Quantum Computing</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center">
                                    <div class="mb-2">
                                        <span class="badge bg-success fs-6">Connected</span>
                                    </div>
                                    <small class="text-muted">Blockchain</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center">
                                    <div class="mb-2">
                                        <span class="badge bg-success fs-6">Enabled</span>
                                    </div>
                                    <small class="text-muted">AI Safety</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Activity -->
                <div class="card bg-dark border-secondary">
                    <div class="card-header bg-secondary text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-clock me-2"></i>Recent Activity
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="list-group list-group-flush">
                            <div class="list-group-item bg-dark border-secondary">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">API Key Updated</h6>
                                    <small>3 days ago</small>
                                </div>
                                <p class="mb-1">OpenAI API key was updated successfully</p>
                            </div>
                            <div class="list-group-item bg-dark border-secondary">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">Quantum Enhancement Enabled</h6>
                                    <small>5 days ago</small>
                                </div>
                                <p class="mb-1">Quantum computing capabilities activated</p>
                            </div>
                            <div class="list-group-item bg-dark border-secondary">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">Safety Protocols Updated</h6>
                                    <small>1 week ago</small>
                                </div>
                                <p class="mb-1">AI safety protocols have been updated</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add API Key Modal -->
<div class="modal fade" id="addApiKeyModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content bg-dark">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-key me-2"></i>Add API Key
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Provider</label>
                    <select id="apiProvider" class="form-select bg-dark text-light border-secondary">
                        <option value="openai">OpenAI</option>
                        <option value="anthropic">Anthropic</option>
                        <option value="google">Google AI</option>
                        <option value="cohere">Cohere</option>
                        <option value="dalle">DALL-E</option>
                        <option value="midjourney">Midjourney</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">API Key</label>
                    <input type="password" id="apiKeyInput" class="form-control bg-dark text-light border-secondary" 
                           placeholder="Enter your API key">
                </div>
                <div class="mb-3">
                    <small class="text-muted">
                        <i class="fas fa-info-circle me-1"></i>
                        Your API key will be encrypted and stored securely.
                    </small>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="handleAddApiKey()">
                    <i class="fas fa-plus me-2"></i>Add Key
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function addApiKey() {
        const modal = new bootstrap.Modal(document.getElementById('addApiKeyModal'));
        modal.show();
    }
    
    function handleAddApiKey() {
        const provider = document.getElementById('apiProvider').value;
        const apiKey = document.getElementById('apiKeyInput').value;
        
        if (!provider || !apiKey) {
            alert('Please select a provider and enter an API key');
            return;
        }
        
        fetch('/settings/model', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams({
                provider: provider,
                api_key: apiKey
            })
        })
        .then(response => {
            if (response.ok) {
                alert('API key added successfully!');
                location.reload();
            } else {
                alert('Failed to add API key');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Failed to add API key');
        });
    }
    
    function toggleApiKey(keyId) {
        fetch(`/settings/api-key/${keyId}/toggle`, {
            method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                alert('Failed to toggle API key: ' + data.error);
            } else {
                alert('API key status updated');
                location.reload();
            }
        });
    }
    
    function deleteApiKey(keyId) {
        if (confirm('Are you sure you want to delete this API key?')) {
            fetch(`/settings/api-key/${keyId}/delete`, {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert('Failed to delete API key: ' + data.error);
                } else {
                    alert('API key deleted successfully');
                    location.reload();
                }
            });
        }
    }
</script>
{% endblock %}

